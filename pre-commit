#! /bin/sh

findFilesChanged(){
    git diff --staged --name-only
}

findChanges(){
    read files

    egrep -n '([^A-Z0-9][A-Z0-9]{20}([^A-Z0-9]|$)|[^A-Za-z0-9/+=][A-Za-z0-9/+=]{40}([^A-Za-z0-9/+=]|$)|[^A-Za-z0-9/+][A-Za-z0-9/+]{40}([^A-Za-z0-9/+]|$))' "$files"
}

report(){
    read credentials

    if [ -n "$credentials" ]; then
        echo "AWS credentials found. Aborting commit."
        echo $credentials
        exit 1
    else
        exit 0
    fi
}

findFilesChanged | findChanges | report
